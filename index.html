<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><h1>JUSTPOSE GALLERY</h1></header>
    <div id="gallery"></div>

    <div id="photoModal">
        <div class="close-x" onclick="closeModal()">×</div>
        <div id="modalContent"></div>
    </div>

    <script>
        const cloudName = "dntrwkexp";
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('event');

        if (eventId) {
            fetch(`https://res.cloudinary.com/${cloudName}/image/list/${eventId}.json`)
                .then(r => r.json()).then(data => {
                    const gal = document.getElementById('gallery');
                    data.resources.sort((a,b) => new Date(b.created_at) - new Date(a.created_at));
                    data.resources.forEach(img => {
                        const sessId = img.public_id.split('/')[img.public_id.split('/').length - 2];
                        const d = document.createElement('div');
                        d.className = "img-card"; d.onclick = () => openFolder(sessId);
                        d.innerHTML = `<img src="https://res.cloudinary.com/${cloudName}/image/upload/w_400/${img.public_id}.jpg">`;
                        gal.appendChild(d);
                    });
                });
        }

        async function openFolder(sessId) {
            const modal = document.getElementById('photoModal');
            const cont = document.getElementById('modalContent');
            modal.style.display = "flex"; cont.innerHTML = "Loading...";

            const r = await fetch(`https://res.cloudinary.com/${cloudName}/image/list/${sessId}.json`);
            const data = await r.json();
            cont.innerHTML = "";
            
            // FILTER: Huwag isama ang may mahahabang numero o resize
            data.resources.filter(i => !i.public_id.match(/_\d+$/))
            .sort((a,b) => a.public_id.localeCompare(b.public_id))
            .forEach(i => {
                const div = document.createElement('div'); div.className = "folder-item";
                div.innerHTML = `<a href="https://res.cloudinary.com/${cloudName}/image/upload/fl_attachment/${i.public_id}.jpg" class="mini-download-btn">↓</a>
                                 <img src="https://res.cloudinary.com/${cloudName}/image/upload/${i.public_id}.jpg">`;
                cont.appendChild(div);
            });
        }
        function closeModal() { document.getElementById('photoModal').style.display = "none"; }
    </script>
</body>
</html>
